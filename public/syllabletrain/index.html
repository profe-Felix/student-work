<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Syllable Train</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
html,body{
  margin:0;
  height:100%;
}

body{
  font-family: Andika, system-ui, sans-serif;
  background:#fff;
  touch-action:none;
}

/* iframe-safe centered frame */
#frame{
  width:100%;
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
}

#stage{
  padding:40px;
}

#trainRow{
  display:flex;
  align-items:flex-start;
}

#rail{
  display:flex;
  align-items:flex-end;
  margin-left:-120px;
}

/* Controls */

#slotControls{
  display:flex;
  flex-direction:column;
  gap:6px;
  align-items:center;
}

.ctrlBtn{
  width:36px;
  height:30px;
  border:2px solid #cbd5e1;
  border-radius:10px;
  background:#f8fafc;
  color:#2563eb;
  font-size:16px;
  box-shadow:0 2px 0 rgba(0,0,0,.08);
}

/* Engine */

#engine{
  width:280px;
  height:80px;
  background:url("train.png") center bottom/contain no-repeat;
  transform:scale(1.6);
  transform-origin:left bottom;
}

/* Slots */

#slotsWrap{
  display:flex;
  margin-left:15px;
}

#slotsWrap .slot:not(:first-child){
  margin-left:-5px;
}

.slot{
  width:120px;
  height:60px;
  border:2px dashed #bbb;
  border-radius:12px;
  position:relative;
}

/* Sources */

#sources{
  margin-top:26px;
  display:flex;
  gap:28px;
  justify-content:center;
}

.source{
  width:120px;
  height:60px;
}

.source.red{background:url("redtraincar.png") center/contain no-repeat}
.source.blue{background:url("bluetraincar.png") center/contain no-repeat}

/* Cars */

.car{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background-size:100% 100%;
}

.car.red{background-image:url("redtraincar.png")}
.car.blue{background-image:url("bluetraincar.png")}

.car input{
  border:none;
  background:transparent;
  color:white;
  font-size:20px;
  font-weight:bold;
  text-align:center;
  width:80%;
  outline:none;
  pointer-events:none;   /* prevents keyboard popup */
}

/* Drag */

.dragGhost{
  position:fixed;
  width:120px;
  height:60px;
  transform:translate(-50%,-50%);
  pointer-events:none;
  z-index:9999;
}
</style>
</head>

<body>

<div id="frame">
<div id="stage">

<div id="trainRow">

<div id="slotControls">
<button class="ctrlBtn" id="btnUp">⬆️</button>
<button class="ctrlBtn" id="btnDown">⬇️</button>
<div>Slots: <span id="slotCount"></span></div>
</div>

<div id="rail">
<div id="engine"></div>
<div id="slotsWrap"></div>
</div>

</div>

<div id="sources">
<div class="source red" data-color="red"></div>
<div class="source blue" data-color="blue"></div>
</div>

</div>
</div>

<script>
const slotsWrap=document.getElementById("slotsWrap");
const slotCountEl=document.getElementById("slotCount");

let slotCount=4;
const MIN=1,MAX=12;

function renderSlots(){
  const keep=[...slotsWrap.children].map(s=>s.firstChild);
  slotsWrap.innerHTML="";
  for(let i=0;i<slotCount;i++){
    const s=document.createElement("div");
    s.className="slot";
    if(keep[i]) s.appendChild(keep[i]);
    slotsWrap.appendChild(s);
  }
  slotCountEl.textContent=slotCount;
}

btnUp.onclick=()=>{if(slotCount<MAX){slotCount++;renderSlots();}};
btnDown.onclick=()=>{if(slotCount>MIN){slotCount--;renderSlots();}};
renderSlots();

/* -------- Drag -------- */

let dragging=null;

function makeCar(color){
  const c=document.createElement("div");
  c.className="car "+color;
  c.innerHTML="<input>";
  c.addEventListener("pointerdown",e=>startExisting(e,c));
  return c;
}

function startExisting(e,car){
  e.preventDefault();
  dragging={ghost:car};
  car.remove();
  car.classList.add("dragGhost");
  document.body.appendChild(car);
  move(e);
}

document.querySelectorAll(".source").forEach(s=>{
  s.addEventListener("pointerdown",e=>{
    e.preventDefault();
    const g=makeCar(s.dataset.color);
    g.classList.add("dragGhost");
    document.body.appendChild(g);
    dragging={ghost:g};
    move(e);
  });
});

function getXY(e){
  return {x:e.clientX,y:e.clientY};
}

function move(e){
  const p=getXY(e);
  dragging.ghost.style.left=p.x+"px";
  dragging.ghost.style.top=p.y+"px";
}

document.addEventListener("pointermove",e=>dragging&&move(e));

function end(e){
  if(!dragging) return;

  const p=getXY(e);
  let best=null,dist=9999;

  document.querySelectorAll(".slot").forEach(slot=>{
    const r=slot.getBoundingClientRect();
    const cx=r.left+r.width/2;
    const cy=r.top+r.height/2;
    const d=Math.hypot(p.x-cx,p.y-cy);
    if(d<dist){dist=d;best=slot;}
  });

  if(best && dist<140){
    best.innerHTML="";
    best.appendChild(dragging.ghost);
    dragging.ghost.classList.remove("dragGhost");
    dragging.ghost.style.left="";
    dragging.ghost.style.top="";
  }else dragging.ghost.remove();

  dragging=null;
}

document.addEventListener("pointerup",end);
</script>

</body>
</html>
