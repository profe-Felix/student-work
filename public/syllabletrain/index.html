<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Syllable Train</title>

<meta name="viewport"
content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">

<style>
html,body{
  margin:0;
  height:100%;
  overscroll-behavior:none;
}

body{
  font-family:Andika,system-ui,sans-serif;
  background:#fff;
  -webkit-user-select:none;
  user-select:none;
}

/* scroll container */
#frame{
  width:100%;
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
  overflow:auto;
  -webkit-overflow-scrolling:touch;
}

/* main stage (drag surface) */
#stage{
  padding:10px;
  min-width:0;
  touch-action:none;
}


/* Desktop boost */
@media (hover:hover){
  #stage{
    transform:scale(1.35);
    transform-origin:center top;
  }
}


#trainRow{
  display:flex;
  align-items:flex-start;
}

#rail{
  display:flex;
  align-items:flex-end;
  justify-content:flex-start;
}

/* Controls */

#slotControls{
  display:flex;
  flex-direction:column;
  gap:6px;
  align-items:center;
  margin-right:12px;
  position:relative;
  z-index:10;
}

.ctrlBtn{
  width:36px;
  height:30px;
  border:2px solid #cbd5e1;
  border-radius:10px;
  background:#f8fafc;
  color:#2563eb;
  font-size:16px;
  box-shadow:0 2px 0 rgba(0,0,0,.08);
  cursor:pointer;
  touch-action:manipulation;
}

/* Engine */

#engine{
  width:300px;
  height:140px;
  background:url("train.png") center bottom/contain no-repeat;
  flex-shrink:0;
  margin-right:-70px;
  pointer-events:none;
}


/* Slots */

#slotsWrap{
  display:flex;
  margin-left:0px;
}

.slot{
  width:120px;
  height:60px;
  border:2px dashed #bbb;
  border-radius:12px;
  position:relative;
}

/* Sources */

#sources{
  margin-top:26px;
  display:flex;
  gap:28px;
  justify-content:center;
}

.source{
  width:120px;
  height:60px;
  cursor:grab;
  touch-action:none;
}

.source.red{background:url("redtraincar.png") center/contain no-repeat}
.source.blue{background:url("bluetraincar.png") center/contain no-repeat}

/* Cars */

.car{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background-size:100% 100%;
  background-position:center;
  background-repeat:no-repeat;
}

.car.red{background-image:url("redtraincar.png")}
.car.blue{background-image:url("bluetraincar.png")}

/* Editable label */


/* Drag ghost */

.dragGhost{
  position:fixed;
  width:120px;
  height:60px;
  transform:translate(-50%,-50%);
  pointer-events:none;
  z-index:9999;
}

</style>
</head>

<body>

<div id="frame">
<div id="stage">

<div id="trainRow">

<div id="slotControls">
<button class="ctrlBtn" id="btnUp" type="button">⬆️</button>
<button class="ctrlBtn" id="btnDown" type="button">⬇️</button>
<div>Slots: <span id="slotCount"></span></div>
</div>

<div id="rail">
<div id="engine"></div>
<div id="slotsWrap"></div>
</div>

</div>

<div id="sources">
<div class="source red" data-color="red"></div>
<div class="source blue" data-color="blue"></div>
</div>

</div>
</div>

<script>
const frame = document.getElementById("frame");
const slotsWrap = document.getElementById("slotsWrap");
const slotCountEl = document.getElementById("slotCount");
const btnUp = document.getElementById("btnUp");
const btnDown = document.getElementById("btnDown");

let slotCount = 4;
const MIN = 1, MAX = 12;

function centerFrame(){
  const maxScroll = frame.scrollWidth - frame.clientWidth;
  frame.scrollLeft = maxScroll > 0 ? Math.round(maxScroll/2) : 0;
}

function renderSlots(){
  const keep=[...slotsWrap.children].map(s=>s.firstChild);
  slotsWrap.innerHTML="";
  for(let i=0;i<slotCount;i++){
    const s=document.createElement("div");
    s.className="slot";
    if(keep[i]) s.appendChild(keep[i]);
    slotsWrap.appendChild(s);
  }
  slotCountEl.textContent=slotCount;
  requestAnimationFrame(centerFrame);
}

btnUp.addEventListener("pointerdown",e=>{
  e.preventDefault();
  if(slotCount<MAX){slotCount++;renderSlots();}
});

btnDown.addEventListener("pointerdown",e=>{
  e.preventDefault();
  if(slotCount>MIN){slotCount--;renderSlots();}
});

renderSlots();
window.addEventListener("resize",()=>requestAnimationFrame(centerFrame));

/* ---- Drag ---- */

let dragging=null;

function makeCar(color){
  const c=document.createElement("div");
  c.className="car "+color;

  c.addEventListener("pointerdown",e=>{
    e.preventDefault();
    startExisting(e,c);
  });

  return c;
}



function startExisting(e,car){
  e.preventDefault();

  dragging={ghost:car};
  car.remove();
  car.classList.add("dragGhost");
  document.body.appendChild(car);
  move(e);
}

document.querySelectorAll(".source").forEach(src=>{
  src.addEventListener("pointerdown",e=>{
    e.preventDefault();
    const g=makeCar(src.dataset.color);
    g.classList.add("dragGhost");
    document.body.appendChild(g);
    dragging={ghost:g};
    move(e);
  });
});

function move(e){
  if(!dragging) return;
  dragging.ghost.style.left=e.clientX+"px";
  dragging.ghost.style.top=e.clientY+"px";
}

/* CRITICAL: non-passive so Safari can't scroll */
document.addEventListener("pointermove",e=>{
  if(dragging){
    e.preventDefault();
    move(e);
  }
},{passive:false});

document.addEventListener("pointerup",e=>{
  if(!dragging) return;

  let best=null,dist=9999;

  document.querySelectorAll(".slot").forEach(slot=>{
    const r=slot.getBoundingClientRect();
    const cx=r.left+r.width/2;
    const cy=r.top+r.height/2;
    const d=Math.hypot(e.clientX-cx,e.clientY-cy);
    if(d<dist){dist=d;best=slot;}
  });

  if(best && dist<140){
    best.innerHTML="";
    best.appendChild(dragging.ghost);
    dragging.ghost.classList.remove("dragGhost");
    dragging.ghost.style.left="";
    dragging.ghost.style.top="";
  }else dragging.ghost.remove();

  dragging=null;
});
</script>

</body>
</html>








